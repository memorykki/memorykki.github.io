<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>计算机网络 | Memorykk | never too late to learn</title>

  
  <meta name="author" content="Memorykk">
  

  
  <meta name="description" content="computer,program,developer,java,linux">
  

  
  <meta name="keywords" content="computer,study,log,tool,fragment,program,developer,java,linux">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="计算机网络"/>

  <meta property="og:site_name" content="Memorykk"/>

  
  <meta property="og:image" content="/images/favicon.ico"/>
  

  <link href="/images/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Memorykk" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">Memorykk</a>
    </h1>
    <p class="site-description">never too late to learn</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/about">关于</a></li>
      
        <li><a href="/atom.xml">订阅</a></li>
      
    </ul>
  </nav>
</header>

    <main  class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>计算机网络</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/network-basic.html" rel="bookmark">
        <time class="entry-date published" datetime="2021-03-14T03:39:36.000Z">
          2021-03-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>概述、物理层、数据链路层</p>
<span id="more"></span>
<hr>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="互联网概述"><a href="#互联网概述" class="headerlink" title="互联网概述"></a>互联网概述</h2><ul>
<li><p>三大网：电信网、有线电视网、计算机网络。</p>
</li>
<li><p>计算机网络：简称为“网络”，由若干结点和连接这些节点的链路组成。</p>
</li>
<li><p>互连网（internet）：网络通过路由器互连起来构成更大的计算机网络，即“网络的网络”。</p>
</li>
<li><p>主机：与网络相连的计算机。</p>
</li>
<li><p>互联网（Internet）：当前全球最大的、开放的、众多网络互连而成的特定互连网，采用TCP/IP协议族作为通信规则。</p>
</li>
<li><p>互联网服务提供者ISP：商业公司ISP共同拥有整个互联网。</p>
</li>
<li><p>互联网的多层次ISP结构：主干ISP、地区ISP、本地ISP。</p>
</li>
<li><p><img src="/images/network-basic/multi-isp.png" alt="multi-isp.png"></p>
</li>
<li><p>互联网交换点IXP：允许两个网络直接相连并交换分组，而不再需要通过更高层的ISP转发分组，从而加快效率。IXP常采用工作在数据链路层的网络交换机，用局域网连接起来。</p>
</li>
</ul>
<h2 id="互联网的组成"><a href="#互联网的组成" class="headerlink" title="互联网的组成"></a>互联网的组成</h2><p>从工作方式上看，分为：</p>
<ul>
<li>边缘部分：由所有来凝结在互联网上的主机组成，用户直接使用，用来进行通信和资源共享，即资源子网。</li>
<li>核心部分：由大量网络和连接这些网络的路由器组成，为边缘部分提供连通性和交换，即通信子网。</li>
</ul>
<h3 id="边缘部分"><a href="#边缘部分" class="headerlink" title="边缘部分"></a>边缘部分</h3><p>连接在互联网上的所有主机又称为“端系统”。端系统之间的通信实质是进程之间的通信。<br>通信方式有两类：客户服务器方式（C/S）、对等方式（P2P）。</p>
<h4 id="客户-服务器方式"><a href="#客户-服务器方式" class="headerlink" title="客户-服务器方式"></a>客户-服务器方式</h4><p>描述的是两个应用进程之间服务与被服务的关系。<br>客户是服务请求方，服务器是服务提供方。</p>
<p><img src="/images/network-basic/cs.png" alt="cs.png"></p>
<p><strong>客户程序</strong></p>
<ul>
<li>被用户调用后运行，通信时主动想S发起请求，C必须知道S的地址；</li>
<li>不需要特殊的硬件和复杂的OS。</li>
</ul>
<p><strong>服务器程序</strong></p>
<ul>
<li>系统启动后自动调用并不断运行，被动地等待并接受C请求，可同时处理多个请求；</li>
<li>一般需要强大的硬件和复杂的OS支持。</li>
</ul>
<h4 id="对等连接方式"><a href="#对等连接方式" class="headerlink" title="对等连接方式"></a>对等连接方式</h4><p>两台主机在通信时不区分哪个是C或S，运行P2P软件即可平等通信，本质上看认识C/S方式。</p>
<p><img src="/images/network-basic/p2p.png" alt="p2p.png"></p>
<h3 id="核心部分"><a href="#核心部分" class="headerlink" title="核心部分"></a>核心部分</h3><p>起特殊作用的是<strong>路由器</strong>，实现分组交换。<br>三种交换方式：电路交换、报文交换、分组交换。</p>
<h4 id="电路交换"><a href="#电路交换" class="headerlink" title="电路交换"></a>电路交换</h4><p>从通信资源的分配角度来看，交换就是按照某种方式动态地分配传输线路的资源。</p>
<p>在通话之前，必须先拨号请求建立连接，也就是一条专用的物理通路。挂机后，交换机释放刚才使用的这条专用的物<br>理通路。这种必须经过“建立连接（占用通信资源）→通话（一直占用通信资源）→释放连接（归还通信资源）”的交换方式即“电路交换”。</p>
<p>在通话的全部时间内，通话的两个用户始终占用端到端的通信资源。</p>
<p><img src="/images/network-basic/circuitSwitch.png" alt="circuitSwitch.png"></p>
<p>使用电路交换的线路的传输效率十分低。</p>
<h4 id="分组交换"><a href="#分组交换" class="headerlink" title="分组交换"></a>分组交换</h4><p>采用存储转发技术，待发送的在整个数据块称为报文，发送之前将报文划分成等长的数据段，再加上必要的控制信息组成的首部构成分组，又称为“包”。</p>
<p><img src="/images/network-basic/message.png" alt="message.png"></p>
<p>主机H1向主机H5发送数据。主机H1先将分组逐个地发往与它<br>直接相连的路由器A。此时,除链路H1-A外,其他通信链路并不被目前通信的双方所占<br>用。需要注意的是,即使是链路H1-A,也只是当分组正在此链路上传送时才被占用。在各<br>分组传送之间的空闲时间,链路H1-A仍可为其他主机发送的分组使用。</p>
<p><img src="/images/network-basic/packetSwitch.png" alt="packetSwitch.png"></p>
<p>优点|所采用的手段<br>|—|—|<br>高效|在分组传输的过程中动态分配传输带宽,对通信链路是逐段占用<br>灵活|为每一个分组独立地选择最合适的转发路由<br>迅速|以分组作为传送单位,可以不先建立连接就能向其他主机发送分组<br>可靠|保证可靠性的网络协议:分布式多路由的分组交换网,使网络有很好的生存性</p>
<p>问题：</p>
<ul>
<li>分组在各路由器存储转发时需要排队，造成时延；</li>
<li>各分组携带的控制信息造成开销</li>
</ul>
<h4 id="报文交换"><a href="#报文交换" class="headerlink" title="报文交换"></a>报文交换</h4><p>采用存储转发原理，但每次交换整个报文。</p>
<p>三种交换方式的比较：</p>
<p><img src="/images/network-basic/switch.png"></p>
<h2 id="计算机网络的性能指标"><a href="#计算机网络的性能指标" class="headerlink" title="计算机网络的性能指标"></a>计算机网络的性能指标</h2><h3 id="速率"><a href="#速率" class="headerlink" title="速率"></a>速率</h3><p>用的信息量的单位。网络技术中的速率指的是数据的传送速率,它也称为数据率<br>或比特率( bit rate)。速率是计算机网络中最重要的一个性能指标。速率的单位是bit/s。</p>
<p>当提到网络的速率时,往往指的是额定速率或标称速率,而并非网络实际上运行的</p>
<h3 id="带宽"><a href="#带宽" class="headerlink" title="带宽"></a>带宽</h3><p>带宽本来是指某个信号具有的频带宽度。在计算机网络中,带宽用来表示网络中某通道传送数据的能力,因此网络带宽表示在单位时间内网络中的某信道所能通过的“最高数据率”，单位bit/s。</p>
<p>前者为频域称谓,而后者为时域称谓,其本质是相同<br>的。</p>
<h3 id="吞吐量"><a href="#吞吐量" class="headerlink" title="吞吐量"></a>吞吐量</h3><p>吞吐量表示在单位时间内通过某个网络(或信道、接口)的实际的数据<br>量。吞吐量更经常地用于对现实世界中的网络的一种测量,以便知道实际上到底有多少数据量能够通过网络。显然,吞吐量受网络的带宽或网络的额定速率的限制。</p>
<h3 id="时延"><a href="#时延" class="headerlink" title="时延"></a>时延</h3><p>时延包括以下几个部分：</p>
<ul>
<li>发送时延：主机或路由器发送数据帧所需要的时间</li>
</ul>
<p>$$<br>发送时延=\frac{数据帧长度（bit）}{发送速率（bit/s）}<br>$$</p>
<ul>
<li>传播时延 电磁波在信道中传播一定的距离需要花费的时间。</li>
</ul>
<p>$$<br>传播时延=\frac{信道长度(m)}{电磁波在信道上的传播速率(m/s)}<br>$$</p>
<p>发送时延与传输信道的长度没有关系，传播时延与信号的发送速率无关。</p>
<ul>
<li><p>处理时延：主机或路由器在收到分组时要花费一定的时间进行处理,例如分析分<br>组的首部、从分组中提取数据部分、进行差错检验或査找适当的路由等。</p>
</li>
<li><p>排队时延 分组在经过网络传输时,要经过许多路由器。但分组在进入路由器后<br>要先在输入队列中排队等待处理。排队时延的长短往往取决于网络当时的通信量。<br>$$<br>总时延=发送时延+传播时延+处理时延+排队时延<br>$$</p>
</li>
</ul>
<p><img src="/images/network-basic/delay.png"></p>
<p>对于高速链路，提高的仅仅是数据的发送速率而非比特在链路上的传播速率，减小了数据的发送时延，所以比特不会传送得更快。</p>
<h3 id="时延带宽积"><a href="#时延带宽积" class="headerlink" title="时延带宽积"></a>时延带宽积</h3><p>$$<br>时延带宽积=传播时延*带宽<br>$$</p>
<p>管道中的比特数表示发送端发出的但未到达接收端的比特。</p>
<h3 id="往返时间RTT"><a href="#往返时间RTT" class="headerlink" title="往返时间RTT"></a>往返时间RTT</h3><p>信息双向交互一次所需的时间。</p>
<p>$$<br>有效数据率=\frac{数据长度}{发送时间+RTT}<br>$$</p>
<h3 id="利用率"><a href="#利用率" class="headerlink" title="利用率"></a>利用率</h3><p>$$<br>当前时延=\frac{网络空闲时的时延}{1-利用率}<br>$$</p>
<p>这里U是网络的利用率,数值在0到1之间。当网络的利用率达到其容量的1/2时<br>时延就要加倍。</p>
<p>当网络的利用率接近最大值1时,网络的时延就趋于无穷大。因此我们必须有这样的概念:信道或网络的利用率过高会产生非常大的时延。</p>
<p><img src="/images/network-basic/delay-U.png"></p>
<h2 id="计算机网络体系结构"><a href="#计算机网络体系结构" class="headerlink" title="计算机网络体系结构"></a>计算机网络体系结构</h2><p>法律上的国际标准：OSI<br>事实上的国籍标准：TCP/IP</p>
<p>网络协议：未进行网络中的数据交换而建立的规则、标准或约定。包括：</p>
<ul>
<li>语法：即数据与控制信息的结构或格式</li>
<li>语义：即需要发出何种控制信息,完成何种动作以及做出何种响应，例如重传或丢弃的时间</li>
<li>同步：即事件实现顺序的详细说明</li>
</ul>
<p><img src="/images/network-basic/OSI.png"></p>
<h3 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h3><p>物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。</p>
<p>下4层完成通信子网的功能，上3层完成资源子网的功能。</p>
<p><img src="/images/network-basic/osi7.png"></p>
<h4 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h4><p>利用传输介质为数据链路层提供物理连接，实现比特流的透明传输，尽可能屏蔽掉具体传输介质和物理设备的差异。使其上面的数据链路层不必考虑网络的具体传输介质是什么。</p>
<p>考虑多大的电压代表“1”“0”，接收方应如何识别，电缆的插头应有多少根引脚、如何连接等。</p>
<h4 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h4><p>在物理层提供的比特流的基础上，通过差错控制、封装成帧、流量控制提供可靠的通过物理介质传输数据的方法。</p>
<p>该层通常又被分为介质访问控制（MAC）和逻辑链路控制（LLC）两个子层。</p>
<p>数据链路层的具体工作是接收来自物理层的位流形式的数据，并封装成帧，传送到上一层；同样，也将来自上层的数据帧，拆装为位流形式的数据转发到物理层；并且，还负责处理接收端发回的确认帧的信息，以便提供可靠的数据传输。</p>
<h4 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h4><p>将上层的报文段或用户数据报封装成分组，也叫IP数据报。</p>
<p>另一个任务就是要选择合适的路由,使源主机运输层所传下来的分组,能够通过网络中的路由器找到目的主机。</p>
<p>数据链路层是解决同一网络内节点之间的通信，而网络层主要解决不同子网间的通信。</p>
<ul>
<li>寻址：数据链路层中使用的物理地址（如MAC地址）仅解决网络内部的寻址问题。在不同子网之间通信时，为了识别和找到网络中的设备，每一子网中的设备都会被分配一个唯一的地址。由于各子网使用的物理技术可能不同，因此这个地址应当是逻辑地址（如IP地址）。</li>
<li>交换：规定不同的信息交换方式。常见的交换技术有：线路交换技术和存储转发技术，后者又包括报文交换技术和分组交换技术。</li>
<li>路由算法：当源节点和目的节点之间存在多条路径时，本层可以根据路由算法，通过网络为数据分组选择最佳路径，并将信息从最合适的路径由发送端传送到接收端。</li>
<li>连接服务：与数据链路层流量控制不同的是，前者控制的是网络相邻节点间的流量，后者控制的是从源节点到目的节点间的流量。其目的在于防止阻塞，并进行差错检测。</li>
</ul>
<h4 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h4><p>OSI下3层的主要任务是数据通信，上3层的任务是数据处理。而传输层是通信子网和资源子网的接口和桥梁，起到承上启下的作用。</p>
<ul>
<li>传输连接管理：提供建立、维护和拆除传输连接的功能。传输层在网络层的基础上为高层提供“面向连接”和“面向无接连”的两种服务。</li>
<li>处理传输差错：提供可靠的“面向连接”和不太可靠的“面向无连接”的数据传输服务、差错控制和流量控制。在提供“面向连接”服务时，通过这一层传输的数据将由目标设备确认，如果在指定的时间内未收到确认信息，数据将被重发。</li>
</ul>
<h4 id="会话层"><a href="#会话层" class="headerlink" title="会话层"></a>会话层</h4><p>向两个实体的表示层提供建立和使用连接的方法。将不同实体之间的表示层的连接称为会话。因此会话层的任务就是组织和协调两个会话进程之间的通信，并对数据交换进行管理。</p>
<ul>
<li>会话管理：允许用户在两个实体设备之间建立、维持和终止会话，并支持它们之间的数据交换。例如提供单方向会话或双向同时会话，并管理会话中的发送顺序，以及会话所占用时间的长短。</li>
<li>会话流量控制：提供会话流量控制和交叉会话功能。</li>
<li>寻址：使用远程地址建立会话连接。l</li>
<li>出错控制：从逻辑上讲会话层主要负责数据交换的建立、保持和终止，但实际的工作却是接收来自传输层的数据，并负责纠正错误。会话控制和远程过程调用RPC均属于这一层的功能。但应注意，此层检查的错误不是通信介质的错误，而是磁盘空间、打印机缺纸等类型的高级错误。</li>
</ul>
<h4 id="表示层"><a href="#表示层" class="headerlink" title="表示层"></a>表示层</h4><p>对来自应用层的命令和数据进行解释，对各种语法赋予相应的含义，并按照一定的格式传送给会话层。</p>
<p>其主要功能是“处理用户信息的表示问题，如编码、数据格式转换和加密解密”等。</p>
<ul>
<li>数据格式处理：协商和建立数据交换的格式，解决各应用程序之间在数据格式表示上的差异。</li>
<li>数据的编码：处理字符集和数字的转换。例如由于用户程序中的数据类型（整型或实型、有符号或无符号等）、用户标识等都可以有不同的表示方式，因此，在设备之间需要具有在不同字符集或格式之间转换的功能。</li>
<li>压缩和解压缩：为了减少数据的传输量，这一层还负责数据的压缩与恢复。</li>
<li>数据的加密和解密：可以提高网络的安全性。</li>
</ul>
<h4 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h4><p>计算机用户，以及各种应用程序和网络之间的接口，其功能是直接向用户提供服务，通过应用进程间的交互完成特定的网络应用。</p>
<ul>
<li>用户接口：应用层是用户与网络，以及应用程序与网络间的直接接口，使得用户能够与网络进行交互式联系。</li>
<li>实现各种服务：该层具有的各种应用程序可以完成和实现用户请求的各种服务。</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>OSI七层：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。<br>TCP/IP四层：网络接口层、 网际层、运输层、 应用层。<br>五层协议：物理层、数据链路层、网络层、运输层、 应用层。</p>
<p><strong>协议</strong><br>物理层：RJ45、CLOCK、IEEE802.3（网卡，网线，集线器，中继器，调制解调器）<br>数据链路：PPP、FR、HDLC、VLAN、MAC（网桥，交换机）<br>网络层：IP、ICMP、ARP、RARP、OSPF、IPX、RIP、IGRP（路由器）<br>传输层：TCP、UDP、SPX<br>会话层：NFS、SQL、NETBIOS、RPC<br>表示层：JPEG、MPEG、ASII<br>应用层：FTP、DNS、Telnet、SMTP、HTTP、WWW、NFS</p>
<p><img src="/images/network-basic/protocolFamily.png"></p>
<p><strong>作用</strong><br>物理层：通过媒介传输比特,确定机械及电气规范（比特Bit）<br>数据链路层：将比特组装成帧和点到点的传递（帧Frame）<br>网络层：负责数据包从源到宿的传递和网际互连（包PackeT）<br>传输层：提供端到端的可靠报文传递和错误恢复（段Segment）<br>会话层：建立、管理和终止会话（会话协议数据单元SPDU）<br>表示层：对数据进行翻译、加密和压缩（表示协议数据单元PPDU）<br>应用层：允许访问OSI环境的手段（应用协议数据单元APDU）  </p>
<p><img src="/images/network-basic/data.png"></p>
<p>协议数据单元PDU：对等层次之间传送的数据单位。<br>服务数据单元SDU：层间交换的数据单位。<br>服务访问点SAP：同意系统中相邻两层的实体交换信息的地方。</p>
<p><img src="/images/network-basic/service-relation.png"></p>
<p>协议是水平的，服务是垂直的。</p>
<h1 id="物理层-1"><a href="#物理层-1" class="headerlink" title="物理层"></a>物理层</h1><p>首先要强调指岀,物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据<br>比特流,而不是指具体的传输媒体。现有的计算机网络中的硬件设备和传输媒体<br>的种类非常繁多,而通信手段也有许多不同方式。物理层的作用正是要尽可能地屏蔽掉这些<br>传输媒体和通信手段的差异,使物理层上面的数据链路层感觉不到这些差异。</p>
<p>可以将物理层的主要任务描述为确定与传输媒体的接口有关的一些特性,即</p>
<ol>
<li>机械特性指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装<br>置,等。平时常见的各种规格的接插件都有严格的标准化的规定。</li>
<li>电气特性指明在接口电缆的各条线上出现的电压的范围。</li>
<li>功能特性指明某条线上出现的某一电平的电压的意义。</li>
<li>过程特性指明对于不同功能的各种可能事件的出现顺序</li>
</ol>
<p>物理层还要完成串行-&gt;并行传输的转换。</p>
<h2 id="数据通信"><a href="#数据通信" class="headerlink" title="数据通信"></a>数据通信</h2><h3 id="数据通信系统"><a href="#数据通信系统" class="headerlink" title="数据通信系统"></a>数据通信系统</h3><p>可划分为三大部分,即源系统(或发送端、发送方)、传输系统(或传输网络)和目的系统(或接收端、接收方)。</p>
<p><img src="/images/network-basic/DataCommunication.png"></p>
<ul>
<li>模拟信号,或连续信号：代表消息的参数的取值是连续的。</li>
<li>数字信号,或离散信号：代表消息的参数的取值是离散的。代表不同离散数值的基本波形就称为码元。</li>
</ul>
<h3 id="信道"><a href="#信道" class="headerlink" title="信道"></a>信道</h3><p>从通信的双方信息交互的方式来看,可以有以下三种基本方式：</p>
<ul>
<li>单向通信：称为单工通信,即只能有一个方向的通信而没有反方向的交互。无<br>线电广播或有线电广播以及电视广播就属于这种类型</li>
<li>双向交替通信：又称为半双工通信,即通信的双方都可以发送信息,但不能双方<br>同时发送(当然也就不能同时接收)。</li>
<li>双向同时通信：又称为全双工通信,即通信的双方可以同时发送和接收信息<br>单向通信只需要一条信道,而双向交替通信或双向同时通信则都需要两条信道(每个<br>方向各一条)。</li>
</ul>
<p>显然,双向同时通信的传输效率最高。</p>
<p>来自信源的基带信号往往包含有较多的低频成分,甚至有直流成分,而许多信道并不能传输这种低频分量或直流分量。所以必须对基带信号进行调制，分为两大类：</p>
<ul>
<li>基带调制：对基带信号的波形进行变换,使它能够与信道特性相适应，变换后的信号仍然是基带信号，也称为编码。<ul>
<li>不归零制</li>
<li>归零制</li>
<li>曼彻斯特编码</li>
<li>差分曼彻斯特编码</li>
</ul>
</li>
<li>带通调制：使用载波把基带信号的频率范围搬移到较高的频段,并转换为模拟信号，经过载波调制后的信号称为带通信号，即仅在一段频率范围内能够通过信道。<ul>
<li>调幅（AM）</li>
<li>调频（FM）</li>
<li>调相（PM）</li>
</ul>
</li>
</ul>
<h3 id="信道的极限容量"><a href="#信道的极限容量" class="headerlink" title="信道的极限容量"></a>信道的极限容量</h3><p>码间串扰：接收端收到的信号波形就失去了码元之间的清晰界限。<br>严重的码间串扰使得本来分得很清楚的一串码元变得模糊而无法识别。</p>
<p>奈氏准则：在任何信道中,码元传输的速率是有上限的,传输速率超过此上限,就会出现严重的码间串扰的问题。</p>
<p>信噪比：所谓信噪比就是信号的平均功率和噪声的平均功率之比,常记为S/N,并用分贝(dB)作为度量单位。</p>
<p><img src="/images/network-basic/SNR.png"></p>
<p>香农公式：信道的极限信息传输速率C是</p>
<p><img src="/images/network-basic/shannon.png"></p>
<p>式中,W为信道的带宽(Hz);S为信道内所传信号的平均功率;N为信道内<br>部的高斯噪声功率。</p>
<p>香农公式的意义在于:只要信息传输速率低于信道的极限信息传输速率,就一定存在某种办法来实现无差错的传输。</p>
<p>从以上所讲的不难看出,对于频带宽度已确定的信道,可以用编码的方法让每一个码元携带更多比特的信息量。</p>
<h2 id="物理层下的传输媒体"><a href="#物理层下的传输媒体" class="headerlink" title="物理层下的传输媒体"></a>物理层下的传输媒体</h2><ul>
<li>导引型<ul>
<li>双绞线</li>
<li>同轴线缆</li>
<li>光缆</li>
</ul>
</li>
<li>非导引型<ul>
<li>短波通信</li>
<li>无线电微波通信</li>
<li>卫星通信</li>
</ul>
</li>
</ul>
<h2 id="信道复用技术"><a href="#信道复用技术" class="headerlink" title="信道复用技术"></a>信道复用技术</h2><p><img src="/images/network-basic/multiplexing.png"></p>
<ul>
<li>频分复用（FDM）：所有用户在同样的时间占用不同的带宽资源。</li>
<li>时分复用（TDM）：所有用户在不同的时间占用同样的频带宽度，又称为同步时分复用。</li>
</ul>
<p><img src="/images/network-basic/FDM-TDM.png"></p>
<ul>
<li>统计时分复用（STDM）：改进的时分复用，缓存用户数据放入STDM帧，又称为异步时分复用</li>
<li>波分复用（WDM）：光的频分复用。</li>
<li>码分复用（CDM）：共享信道。</li>
</ul>
<h2 id="宽带接入技术"><a href="#宽带接入技术" class="headerlink" title="宽带接入技术"></a>宽带接入技术</h2><ul>
<li>ADSL技术：改造电话用户线；</li>
<li>光纤同轴混合网（HFC网）：改造有线电视网；</li>
<li>光纤到户（FTTx）：光信号转电信号。</li>
</ul>
<h1 id="数据链路层-1"><a href="#数据链路层-1" class="headerlink" title="数据链路层"></a>数据链路层</h1><p>数据链路层使用的信道：</p>
<ul>
<li>点对点信道。这种信道使用一对一的点对点通信方式。</li>
<li>广播信道。这种信道使用一对多的广播通信方式。</li>
</ul>
<h2 id="使用点对点信道"><a href="#使用点对点信道" class="headerlink" title="使用点对点信道"></a>使用点对点信道</h2><h3 id="三个基本问题"><a href="#三个基本问题" class="headerlink" title="三个基本问题"></a>三个基本问题</h3><p>封装成帧。透明传输、差错检测</p>
<h4 id="封装成帧"><a href="#封装成帧" class="headerlink" title="封装成帧"></a>封装成帧</h4><p>封装成帧就是在一段数据的前后分别添加首部和尾部,这样就构成了一个帧，</p>
<p>首部和尾部的一个重要作用就是进行帧定界(即确定帧的界限)。此外,首部和尾部还包括许多必要的控制信息。应当使帧的数据部分长度尽可能地大于首部和尾部的长度。每一种链路层协议都规定了所能传送的帧的数据部分长度上限—最大传送<br>单元MTU。</p>
<p><img src="/images/network-basic/MTU.PNG"></p>
<p>帧定界符SOH和EOT标识真的开始与结束，用以判断一个完整的帧。</p>
<h4 id="透明传输"><a href="#透明传输" class="headerlink" title="透明传输"></a>透明传输</h4><p>当传送的用文本组成的帧时，不管从键盘上输入什么字符都可以放在这样的帧中传输过去,因此这样的传输就是透明传输。</p>
<p>但当数据部分是非ASCI码的文本文件时(如二进制代码的计算机程序或图像等),情<br>况就不同了。如果数据中的某个字节的二进制代码恰好和SOH或EOT这种控制字符一样<br>，数据链路层就会错误地“找到帧的边界”,把部分帧收下(误认为是个完整的<br>帧),而把剩下的那部分数据丢弃(这部分找不到帧定界控制字符SOH)。</p>
<p><img src="/images/network-basic/EOT.PNG"></p>
<p><strong>字符填充</strong></p>
<p>为了解决透明传输问题，发送端的数据链路层在数据中出现控制字符<br>SOH”或“EOT”的前面插入一个转义字符“ESC”。而在接收端的数据链路层在把数据送往网络层之前删除这个插入的转义字符。</p>
<h4 id="差错检测"><a href="#差错检测" class="headerlink" title="差错检测"></a>差错检测</h4><p>比特差错：比特在传输过程中可能会产生差错：1可能会变成0,而0也可能变成1。</p>
<p>误码率BER：在一段时间内,传输错误的比特占所传输比特总数的比率。</p>
<p><strong>循环冗余检验CRC</strong></p>
<p><img src="/images/network-basic/CRC1.PNG"><br><img src="/images/network-basic/CRC2.PNG"></p>
<p>判定这个帧有差错，但无法确定究竟是哪一位或哪几位出现了差错。</p>
<p>在数据链路层若仅仅使用循环冗余检验CRC差错检测技术,则只能做到对帧的无差错接受</p>
<p>即:“凡是接收端数据链路层接受的帧,我们都能以非常接近于1的概率认为这些帧在传输过程中没有产生差错”。接收端丢弃的帧虽然曾收到了,但最终还是因为有差错被丢弃,即没有被接受。</p>
<p>传输差错：帧丢失、帧重复或帧失序。</p>
<p>过去oSI的观点是:必须让数据链路层向上提供可靠传输。因此在CRC检错的基础上,增加了帧编号、确认和重传机制。</p>
<h3 id="点对点协议PPP"><a href="#点对点协议PPP" class="headerlink" title="点对点协议PPP"></a>点对点协议PPP</h3><p>在TCP/P协议族中,可靠传输由运输层的TCP协议负责,因此数据链路层的PPP协<br>议不需要进行纠错,不需要设置序号,也不需要进行流量控制。PPP协议不支持多点线路，只支持点对点的链路通信。此外，PPP协议只支持全双工链路。</p>
<h4 id="协议组成"><a href="#协议组成" class="headerlink" title="协议组成"></a>协议组成</h4><p>PPP协议有三个组成部分：</p>
<ol>
<li>将P数据报封装到串行链路的方法。PP既支持异步链路(无奇偶检验的8比<br>特数据),也支持面向比特的同步链路。IP数据报在PPP帧中就是其信息部分。这个信息部分的长度受最大传送单元MTU的限制。</li>
<li>用来建立、配置和测试数据链路连接的链路控制协议LCP( Link Cont<br>Protoco)。通信的双方可协商一些选项。在RFC1661中定义了11种类型的LCP分组</li>
<li>一套网络控制协议 NCP(Network Control Protocol)°,其中的每一个协议支持不同的网络层协议,如IP、OSI的网络层、 DECnet,以及 AppleTalk等</li>
</ol>
<h4 id="PPP帧格式"><a href="#PPP帧格式" class="headerlink" title="PPP帧格式"></a>PPP帧格式</h4><p><img src="/images/network-basic/PPP.PNG"></p>
<ul>
<li>F：0x7E 01111110，标志字段，标识帧的开始或结束</li>
<li>A、C：无意义</li>
<li>协议：表示信息部分使用的协议类型</li>
<li>FCS：检验序列</li>
</ul>
<p><strong>字节填充</strong><br>使用异步传输时,它把转义符定义为0xD(即ol11101),并使用字节填充<br>RFC1662规定了如下所述的填充方法</p>
<ol>
<li>把信息字段中出现的每一个0x7E字节转变成为2字节序列(0x7D,0x5E)</li>
<li>若信息字段中出现一个0x7D的字节(即出现了和转义字符一样的比特组合),则<br>把0x7D转变成为2字节序列(0x7D,0x5D)</li>
<li>若信息字段中出现ASCI码的控制字符(即数值小于0x20的字符),则在该字符前<br>面要加入一个αx⑦D字节,同时将该字符的编码加以改变。例如,出现0x03(在控制字符中是“传输结束”ETX)就要把它转变为2字节序列(0x7D,Ox23)。</li>
</ol>
<p><strong>零比特填充</strong><br>使用同步传输时，在发送端，只要发现有5个连续1,则立即填入一个0。因此经过这种填充后的数据,就可以保证在信息字段中不会出现6个连续1。接收端在收到一个帧<br>时,先找到标志字段F以确定一个帧的边界,接着再用硬件对其中的比特流进行扫描。每当发现5个连续1时,就把这5个连续1后的一个0删除,以还原成原来的信息比特流。</p>
<h4 id="PPP协议工作状态"><a href="#PPP协议工作状态" class="headerlink" title="PPP协议工作状态"></a>PPP协议工作状态</h4><p><img src="/images/network-basic/PPPstatus.PNG"></p>
<p>当用户拨号接入ISP后,就建立了一条从用户个人电脑到IsP的物理连接。这时,用户个人电脑向ISSP发送一系列的链路控制协议LCP分组(封装成多个PPP帧),以便建立LCP连接。这些分组及其响应选择了将要使用的一些PPP参数。接着还要进行网络层配置,网络控制协议NCP给新接入的用户个人电脑分配一个临时的IP地址。这样,用户个人电脑就成为互联网上的一个有IP地址的主机</p>
<p>当用户通信完毕时,NCP释放网络层连接,收回原来分配出去的IP地址。接着,LCP释放数据链路层连接。最后释放的是物理层的连接。</p>
<p>在“网络层协议”状态,PPP链路的两端的网络控制协议NCP根据网络层的不同协议<br>互相交换网络层特定的网络控制分组。这个步骤是很重要的,因为现在的路由器都能够同时支持多种网络层协议。总之,PPP协议两端的网络层可以运行不同的网络层协议,但仍然可使用同一个PP协议进行通信<br>如果在PPP链路上运行的是IP协议,则对PP链路的每一端配置IP协议模块(如分<br>配IP地址)时就要使用NCP中支持IP的协议——IP控制协议IPCP( IP ControlProtoco)<br>IPCP分组也封装成PPP帧(其中的协议字段为0x8021)在PP链路上传送。在低速链路上<br>运行时,双方还可以协商使用压缩的TCP和P首部,以减少在链路上发送的比特数。</p>
<p>PPP协议已不是纯粹的数据链路层的协议,它还包含了物理层和网络层的内容。</p>
<h2 id="使用广播信道"><a href="#使用广播信道" class="headerlink" title="使用广播信道"></a>使用广播信道</h2><h3 id="局域网的数据链路层"><a href="#局域网的数据链路层" class="headerlink" title="局域网的数据链路层"></a>局域网的数据链路层</h3><p>局域网使用的就是广播信道。按照网络拓扑分为星形网、环形网、总线网。<br>总线网以传统以太网最为著名，之后出现的快速以太网、吉比特以太网在市场中占据绝对优势，以太网成为局域网的同义词。</p>
<p>共享信道技术：</p>
<ul>
<li>静态划分信道：复用分用技术；</li>
<li>动态媒体接入控制：又称多点接入<ul>
<li>随机接入：用户随机发送信息，需要解决碰撞；</li>
<li>受控接入：用户发送信息需要服从控制。轮询。</li>
</ul>
</li>
</ul>
<h4 id="以太网的两个标准"><a href="#以太网的两个标准" class="headerlink" title="以太网的两个标准"></a>以太网的两个标准</h4><ul>
<li>DIX Ethernet V2</li>
<li>IEEE 802.3</li>
</ul>
<p>二者差别很小。后来IEEE 802将数据链路层拆分为逻辑链路控制LLC( Logical Link Contro)子层和媒体接入控制MAC( Medium Access Control)子层。与接入到传输媒体有关的内容都放在MAC子层,而LLC子层则与传输媒体无关。</p>
<p>后来市场稳定，LLC子层的作用消失，DIX Ethernet V2市场更大。</p>
<h4 id="适配器"><a href="#适配器" class="headerlink" title="适配器"></a>适配器</h4><p>计算机与外界局域网的连接时通过通信适配器进行的，又称为网络接口卡NIC。装有处理器和存储器（包括RAM和ROM）</p>
<p>作用：</p>
<ul>
<li>串并行的转换</li>
<li>缓存</li>
<li>实现以太网协议</li>
</ul>
<p>工作：</p>
<p>适配器在接收和发送时不使用计算机的CPU。当适配器收到有差错的帧时,就把这个帧直接丢弃而不必通知计算机。收到正确的帧时,它就使用中断来通知该计算机,并交付协议栈中的网络层。</p>
<p>当计算机要发送IP数据报时,就由协议栈把IP数据报向下交给适配器,组装成帧后发送到局域网。</p>
<p>计算机的硬件地址就在适配器的ROM中,而计算机的软件地址（IP地址）则在计算机的存储器中。</p>
<h3 id="CSMA-CD协议"><a href="#CSMA-CD协议" class="headerlink" title="CSMA/CD协议"></a>CSMA/CD协议</h3><p>总线使用。</p>
<p>为了通信简便，采用两个措施：</p>
<ol>
<li>采用较为灵活的无连接的工作方式,即不必先建立连接就可以直接发送数据<br>适配器对发送的数据帧不进行编号,也不要求对方发回确认。以太网提供的服务是尽最大努力的交付,即不可靠的交付。</li>
</ol>
<p>当目的站收到有差错的数据帧时,就把帧丢弃,其他什么也不做。对有差错帧是否需要重传则由高层来决定。</p>
<p>总线上在同一时间只能允许一台计算机发送数据,否则各计算机之间就会互相干扰，因此以太网使用CSMA/CD协议。</p>
<ol start="2">
<li>以太网发送的数据都使用曼彻斯特( Manchester)编码的信号。</li>
</ol>
<p><strong>要点</strong></p>
<ul>
<li>先听后发<br>在发送前检测信道,是为了获得发送权。如果检测出已经有其他站在发送,则自己就暂时不许发送数据,必须要等到信道变为空闲时才能发送。</li>
<li>边听边发<br>在发送中检测信道,是为了及时发现有没有其他站的发送和本站发送的碰撞。</li>
<li>冲突停止<br>当适配器检测到的信号电压变化幅度超过一定的门限值时,就认为总线上至少有两个站同时在发送数据,表明产生了碰撞。适配器就要立即停止发送,免得继续进行无效的<br>发送,白白浪费网络资源,然后等待一段随机时间后再次发送。</li>
<li>延迟重发<br>使用截断二进制指数退避算法确定延迟重发时机。</li>
</ul>
<p>因为传播时延的存在导致先听后发之后人有可能发生碰撞。发送数据后,最迟要经过多长时间才能知道自己发送的数据和其他站发送的数据有没有发生碰撞?这个时间最多是两倍的总线端到端的传播时延(2r),称为争用期，又叫碰撞窗口。，即经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。</p>
<p>因此局域网必须按最坏情况设计,即取总线两端的两个站之间的传播时延(这两个站之间的距离最大)为端到端传播时延。</p>
<p><img src="/images/network-basic/crash.PNG"></p>
<p>显然,在使用 CSMA/CD协议时,一个站不可能同时进行发送和接收(但必须边发送<br>边监听信道)。因此使用 CSMA/CD协议的以太网不可能进行全双工通信而只能进行双向交替通信(半双工通信)。</p>
<p>凡长度小于64字节的帧都是由于冲突而中止的无效帧。</p>
<p><strong>强化碰撞</strong><br>当发送数据的站一旦发现发生了碰撞时,除了立即停止发送数据外,还要再继续发送3比特或48比特的人为干扰信号,以便让所有用户都知道现在已经发生了碰撞。</p>
<p><strong>帧间最小间隔</strong><br>以太网还规定了帧间最小间隔为96μs,相当于96比特时间。这样做是为了使刚刚收<br>到数据帧的站的接收缓存来得及清理,做好接收下一帧的准备。</p>
<h3 id="使用集线器的星形拓扑"><a href="#使用集线器的星形拓扑" class="headerlink" title="使用集线器的星形拓扑"></a>使用集线器的星形拓扑</h3><p>集线器和每个站之间使用两对双绞线，用于发送和接收。<br>IEEE制定了10BASE-T星形以太网标准802.3i。“10”代表10Mbit/s的数据率,BASE表示连接线上的信号是基带信号,T代表双绞线。每个站到集线器的距离不超过100m。</p>
<p><strong>特点</strong></p>
<ul>
<li>用集线器的以太网在逻辑上仍是一个总线网,各站共享逻辑上的总线,使用的还是<br>CSMA/CD协议。</li>
<li>一个集线器有许多接口,每个接口通过RJ-45插头用两对双绞线与一台计算机上的适配器相连。因此,一个集线器很像一个多接口的转发器。</li>
<li>集线器工作在物理层,它的每个接口仅仅简单地转发比特，收到1就转发1,收<br>到0就转发0,不进行碰撞检测。</li>
</ul>
<h3 id="信道利用率"><a href="#信道利用率" class="headerlink" title="信道利用率"></a>信道利用率</h3><p>$$<br>信道利用率a=\frac{单程端到端时延r}{帧的发送时间T}<br>$$</p>
<p>因此，以太网的连线的长度受到限制(否则r数值会太大),同时以太网的帧长不能太短(否则T的值会太小,使a值太大)。</p>
<h3 id="MAC层"><a href="#MAC层" class="headerlink" title="MAC层"></a>MAC层</h3><h4 id="MAC地址"><a href="#MAC地址" class="headerlink" title="MAC地址"></a>MAC地址</h4><p>规定了一种48位的全球地址,是指局域网上的每一台计算机中固化在适配器的ROM中的地址。</p>
<p>适配器从网络上每收到一个MAC帧就先用硬件检査MAC帧中的目的地址。如果是发往本站的帧则收下,然后再进行其他的处理。否则就将此帧丢弃,不再进行其他的处理。</p>
<p>“发往本站的帧”包括以下三种帧：</p>
<ul>
<li>单播(unicast)帧(一对一),即收到的帧的MAC地址与本站的硬件地址相同。</li>
<li>广播(broadcast帧(一对全体),即发送给本局域网上所有站点的帧(全1地址)。</li>
<li>多播(multicas帧(一对多),即发送给本局域网上一部分站点的帧</li>
</ul>
<p>所有的适配器都至少应当能够识别前两种帧,即能够识别单播和广播地址。显然,只有目的地址才能使用广播地址和多播地址。</p>
<h4 id="MAC帧的格式"><a href="#MAC帧的格式" class="headerlink" title="MAC帧的格式"></a>MAC帧的格式</h4><ol>
<li>DIX Ethernet V2</li>
</ol>
<p><img src="/images/network-basic/MAC.PNG"></p>
<p>类型：标注上一层是什么协议。</p>
<p><strong>帧长度</strong><br>在曼彻斯特编码的每一个码元(不管码元是1或0)的正中间一定有次电压的转换(从高到低或从低到高)。当发送方把一个以太网帧发送完毕后,就不再发送其他码元了(既不发送1,也不发送0)。因此,发送方网络适配器的接口上的电压也就不再变化了。这样,接收方就可以很容易地找到以太网帧的结束位置。在这个位置往前数4字节<br>(FCS字段长度是4字节),就能确定数据字段的结束位置。</p>
<p><strong>8字节</strong><br>第一个字段是7个字节的前同步码(1和0交替码),它的作用是使接收端的适配器在接收MAC帧时能够迅速调整其时钟频率,使它和发送端的时钟同步<br>也就是“实现位同步”(位同步就是比特同步的意思)。第二个字段是帧开始定界符,定义为10101011。</p>
<p><strong>定界</strong><br>以太网在传送帧时,各帧之间还必须有一定的间隙。因此,接收端只要找到帧开始定界符,其后面的连续到达的比特流就都属于同一个MAC帧。可见以太网不需要使用帧结束定界符,也不需要使用字节插入来保证透明传输。</p>
<ol start="2">
<li>IEEE802.3</li>
</ol>
<ul>
<li>IEEE8023规定的MAC帧的第三个字段是“长度/类型”。当这个字段值大于<br>0x0600时(相当于十进制的1536),就表示“类型”。这样的帧和以太网V2 MAC帧完全<br>样。只有当这个字段值小于0x0600时才表示“长度”,即MAC帧的数据部分长度。实际上,前面我们已经讲过,由于以太网采用了曼彻斯特编码,长度字段并无实际意义。</li>
<li>当“长度/类型”字段值小于0x0600时,数据字段必须装入上面的逻辑链路控制<br>JC子层的LLC帧。</li>
</ul>
<h3 id="扩展的以太网"><a href="#扩展的以太网" class="headerlink" title="扩展的以太网"></a>扩展的以太网</h3><p>扩展的以太网在网络层看来仍是一个网络。</p>
<h4 id="物理层扩展"><a href="#物理层扩展" class="headerlink" title="物理层扩展"></a>物理层扩展</h4><p>使用多级结构的集线器。</p>
<p><img src="/images/network-basic/physical-ex.PNG"></p>
<p><strong>缺点</strong></p>
<ol>
<li>通过集线器互连起来后就把三个碰撞域变成一个碰撞域，而这时的最大吞吐量没有变化。</li>
<li>如果不同的系使用不同的以太网技术,那么就不可能用集线器将们互连起来。</li>
</ol>
<h4 id="数据链路层扩展"><a href="#数据链路层扩展" class="headerlink" title="数据链路层扩展"></a>数据链路层扩展</h4><p>以太网交换机的出现代替了网桥转发帧。</p>
<h5 id="交换机特点"><a href="#交换机特点" class="headerlink" title="交换机特点"></a>交换机特点</h5><ul>
<li>实质是一个多接口的网桥，全双工工作，具有并行性，即同时连通多对接口使之同时通信。主机独占传输媒体,无碰撞地传输数据；</li>
<li>接口有存储器帮助缓存；</li>
<li>即插即用，内部的交换表通过自学习算法自动建立；</li>
<li>用户独享带宽，增加了总吞吐量；</li>
<li>多种速率的接口</li>
</ul>
<h5 id="路由器与交换机的主要区别"><a href="#路由器与交换机的主要区别" class="headerlink" title="路由器与交换机的主要区别"></a>路由器与交换机的主要区别</h5><ol>
<li>工作层次不同 <br>最初的的交换机是工作在数据链路层，而路由器一开始就设计工作在网络层。由于交换机工作在数据链路层，所以它的工作原理比较简单，而路由器工作在网络层，可以得到更多的协议信息，路由器可以做出更加智能的转发决策。 </li>
<li>数据转发所依据的对象不同 <br>交换机是利用物理地址或者说MAC地址来确定转发数据的目的地址。而路由器则是利用IP地址来确定数据转发的地址。IP地址是在软件中实现的，描述的是设备所在的网络。MAC地址通常是硬件自带的，由网卡生产商来分配的，而且已经固化到了网卡中去，一般来说是不可更改的。而IP地址则通常由网络管理员或系统自动分配。 </li>
<li>传统的交换机只能分割冲突域，不能分割广播域；而路由器可以分割广播域 <br>由交换机连接的网段仍属于同一个广播域，广播数据包会在交换机连接的所有网段上传播，在某些情况下会导致通信拥挤和安全漏洞。连接到路由器上的网段会被分配成不同的广播域，广播数据不会穿过路由器。虽然第三层以上交换机具有VLAN功能，也可以分割广播域，但是各子广播域之间是不能通信交流的，它们之间的交流仍然需要路由器。 </li>
<li>路由器提供了防火墙的服务 <br>路由器仅仅转发特定地址的数据包，不传送不支持路由协议的数据包传送和未知目标网络数据包的传送，从而可以防止广播风暴。</li>
</ol>
<h5 id="以太网的自学习功能"><a href="#以太网的自学习功能" class="headerlink" title="以太网的自学习功能"></a>以太网的自学习功能</h5><p><img src="/images/network-basic/self-learn.PNG"></p>
<p>A先向B发送一帧,从接口1进入到交换机。交换机收到帧后,先查找交换表,没有<br>查到应从哪个接口转发这个帧(在MAC地址这一列中,找不到目的地址为B的项目)。接<br>着,交换机把这个帧的源地址A和接口1写入交换表中,并向除接口1以外的所有接口<br>播这个帧(这个帧就是从接口1进来的,当然不应当把它再从接口1转发出去)。<br>C和D将丢弃这个帧,因为目的地址不对。只B才收下这个目的地址正确的帧。这也<br>称为过滤。<br>从新写入交换表的项目(A,1)可以看出,以后不管从哪一个接口收到帧,只要其目的地<br>址是A,就应当把收到的帧从接口1转发出去。这样做的依据是:既然A发出的帧是从接<br>口1进入到交换机的,那么从交换机的接口1转发出的帧也应当可以到达A。<br>假定接下来B通过接口3向A发送一帧。交换机查找交换表,发现交换表中的MAC地址有A。表明要发送给A的帧(即目的地址为A的帧)应从接口1转发。于是就把这个帧传送到接口1转发给A。显然,现在已经没有必要再广播收到的帧。交换表这时新增加的项目(B,3),表明今后如有发送给B的帧,就应当从接口3转发出去。<br>经过一段时间后,只要主机C和D也向其他主机发送帧,以太网交换机中的交换表就会把转发到C或D应当经过的接口号(2或4)写入到交换表中。这样,交换表中的项目就齐全了。要转发给任何一台主机的帧,都能够很快地在交换表中找到相应的转发接口考虑到有时可能要在交换机的接口更换主机,或者主机要更换其网络适配器,这就需要更改交换表中的项目。为此,在交换表中每个项目都设有一定的有效时间。过期的项目就<br>自动被删除。用这样的方法保证交换表中的数据都符合当前网络的实际状况。<br>以太网交换机的这种自学习方法使得以太网交换机能够即插即用,不必人工进行配置。</p>
<p><strong>生成树协议STP</strong></p>
<p><img src="/images/network-basic/STP.PNG"></p>
<p>假定一开始主机A通过接口交换机#1向主机B发送一帧。交换机#1收到这个帧后就向所有其他接口进行广播发送。现观察其中一个帧的走向:离开交换机#1的<br>接口3→交换机#2的接口1→接口2→交换机#1的接口4→接口3→交换机#的接口这样就无限制地循环兜圈子下去,白白消耗了网络资源<br>为了解决这种兜圈子问题,IEE的8021D标准制定了一个生成树协议STP( Spanning<br>Tree Protocol)。其要点就是不改变网络的实际拓扑,但在逻辑上则切断某些链路,使得从台主机到所有其他主机的路径是无环路的树状结构,从而消除了兜圈子现象。</p>
<h1 id="网络层-1"><a href="#网络层-1" class="headerlink" title="网络层"></a>网络层</h1><h2 id="网络层提供的两种服务"><a href="#网络层提供的两种服务" class="headerlink" title="网络层提供的两种服务"></a>网络层提供的两种服务</h2><ul>
<li>面向连接：虚电路</li>
<li>无连接的</li>
</ul>
<p>网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服。<br>网络在发送分组时不需要先建立连接。每一个分组(也就是IP数据报)独立发送,与其前后的分组无关(不进行编号)。网络层不提供服务质量的承诺。</p>
<p>虚电路服务与数据报服务的对比：</p>
<p>对比的方面|虚电路服务|数据报服务<br>|-|-|-|<br>思路|靠通信应当由网络来保证|可靠通信应当由用户主机来保证<br>连接的建立|必须有|不需要<br>终点地址|仅在连接建立阶段使用,每个分组使用短|每个分组都有终点的完整地址<br>的虚电路号<br>分组的转发|属于同一条虚电路的分组均按照同一路由进行转发|每个分组独立选择路由进行转发<br>当结点出故障时|所有通过出故障的结点的虚电路均不能工作|出故障的结点可能会丢失分组|一些路由会发生变化<br>分组的顺序|总是按发送顺序到达终点|到达终点的时间不一定按发送顺序<br>端到端的差错处理和流量控制|可以由网络负责,也可以由用户主机负责|由用户主机负责</p>
<h2 id="网际协议IP"><a href="#网际协议IP" class="headerlink" title="网际协议IP"></a>网际协议IP</h2><p>与IP协议配套使用的还有三个协议：</p>
<ul>
<li>地址解析协议ARP</li>
<li>网际控制报文协议ICMP</li>
<li>网际组管理协议IGMP</li>
<li><del>逆地址解析协议RARP</del>：使只知道自己硬件地址的主机能够通过RARP协议找出其IP地址。现在的DHCP协议已经包含RARP协议的功能。</li>
</ul>
<h3 id="分类的IP地址"><a href="#分类的IP地址" class="headerlink" title="分类的IP地址"></a>分类的IP地址</h3><p>IP编址经历的三个历史阶段：</p>
<ol>
<li>分类的IP地址</li>
<li>划分子网</li>
<li>构造超网</li>
</ol>
<h4 id="IP地址的表示"><a href="#IP地址的表示" class="headerlink" title="IP地址的表示"></a>IP地址的表示</h4><p>一个网络号在整个互联网范围内必须是唯一的，一台主机号在它前面的网络号所指明的网络范围内必须是唯一的，一个IP地址在整个互联网范围内是唯一的。</p>
<p>两级的IP地址可以记为:<br>IP地址:={&lt;网络号&gt;,&lt;主机号&gt;}</p>
<p><img src="/images/network-basic/divideClassIP.PNG"></p>
<h4 id="常见的三类IP地址"><a href="#常见的三类IP地址" class="headerlink" title="常见的三类IP地址"></a>常见的三类IP地址</h4><p>A类地址的网络号字段占1个字节,只有7位可供使用(该字段的第一位已固定为<br>0),但可指派的网络号是126个(即27-2)。减2的原因是:第一,IP地址中的全0表示<br>“这个this)”。网络号字段为全0的IP地址是个保留地址,意思是“本网络”;第二,网络<br>号为127(即011111作为本地软件环回测试( loopback test)本主机的进程之间的通信之用。目的地址为环回地址的IP数据报永远不会出现在任何网络上,因为网络号为127的地址根本不是一个网络地址。</p>
<p>A类地址的主机号占3个字节,因此每一个A类网络中的最大主机数是24-2,即<br>6770214。这里减2的原因是:全0的主机号字段表示该IP地址是“本主机”所连接到的<br>单个网络地址(例如,一主机的IP地址为567.8,则该主机所在的网络地址就是5.00.0)<br>而全1表示“所有的(a)”,因此全1的主机号字段表示该网络上的所有主机</p>
<p>B类地址的网络号字段有2个字节,但前面两位(10)已经固定了,只剩下14位可以<br>进行分配。因为网络号字段后面的14位无论怎样取值也不可能出现使整个2字节的网络号<br>字段成为全0或全1,因此这里不存在网络总数减2的问题。但实际上B类网络地址</p>
<p>C类地址有3个字节的网络号字段,最前面的3位是(110),还有21位可以进行分<br>配。C类网络地址1920.0.0也是不指派的,可以指派的C类最小网络地址是92010</p>
<p>IP地址的指派范围：</p>
<p>网络类别|最大可指派的网络数|第一个可指派的网络号|最后一个可指派的网络号|每个网络中的最大主机数<br>|-|-|-|-|-|<br>A|2{7}-2|1|126|16777214<br>B|2{14}-2|128.1|191.255|65534<br>C|2{21}-2|192.0.1|223.255.255|254</p>
<p>一般不使用的特殊IP地址</p>
<p>网络号|主机号|源地址使用|目的地址使用|代表的意思<br>|-|-|-|-|-|<br>0|0|可以|不可|在本网络上的本主机(DHCP)<br>0|host-id|可以|不可|在本网络上的某台主机 host-id<br>全1|全1|不可|可以|只在本网络上进行广播(各路由器均不转发)<br>net-id|全1|不可|可以|对net-id上的所有主机进行广播<br>127||非全0或全1的任何数|可以|可以|用于本地软件环回测试</p>
<p><strong>特点</strong></p>
<ul>
<li>每一个IP地址都由网络号和主机号两部分组成。所以IP地址是一种<br>分等级的地址结构。分两个等级的好处是:<ul>
<li>IP地址管理机构在分配I地址时只分配网络号(第一级),而剩下的主机号(第二级)则由得到该网络号的单位自行分配。</li>
<li>路由器仅根据目的主机所连接的网络号来转发分组(而不考虑目的主机号),这样就可以使路由表中的项目数大幅度减少,从而减小了路由表所占的存储空间以及查找路由表的时间。</li>
</ul>
</li>
<li>实际上IP地址是标志一台主机(或路由器)和一条链路的接口。当一台主机同时连<br>接到两个网络上时,该主机就必须同时具有两个相应的IP地址,其网络号必须是不同的<br>这种主机称为多归属主机。</li>
<li>用转发器或网桥连接起来的若干个局域网仍为一个网络,因为这些局域网都具有同样的网络号。具有不同网络号的局域网必须使用路由器进行互连。</li>
<li>所有分配到网络号的网络(不管是范围很小的局域网,还是可能覆盖很大地理范围的广域网)都是平等的。所谓平等,是指互联网同等对待每一个IP地址。</li>
</ul>
<p><img src="/images/network-basic/IPofInternet.PNG"></p>
<h4 id="IP地址与硬件地址"><a href="#IP地址与硬件地址" class="headerlink" title="IP地址与硬件地址"></a>IP地址与硬件地址</h4><p>从层次的角度看,物理地址是数据链路层和物理层使用的地址,而IP地址是网络层和以上各层使用的地址,是一种逻辑地址(用软件实现的)。</p>
<p>IP地址放在IP数据报的首部,而硬件地址则放在MAC帧的首部。在网络层和网络层以上使用的是IP地址,而数据链路层及以下使用的是硬件地址。当IP数据报放入数据链路层的MAC帧中以后,整个的IP数据报就成为MAC帧的数据,因而在数据链路层看不见数据报的IP地址。</p>
<p><img src="/images/network-basic/ip-dl.PNG"></p>
<p><strong>要点</strong></p>
<ol>
<li>在IP层抽象的互联网上只能看到IP数据报。</li>
<li>虽然在P数据报首部有源站IP地址,但路由器只根据目的站的I地址的网络号进行路由选择</li>
<li>在局域网的链路层,只能看见MAC帧。<br>IP数据报被封装在MAC帧中。MAC帧在不同网络上传送时,其MAC帧首部中的源地址和目的地址要发生变化。开始在H1到R1间传送时,MAC帧首部中写的是从硬件地址HA1发送到硬件地址HA3,路由器R1收到此MAC帧后,在数据链路层,要丢弃原来的MAC帧的首部和尾部。在转发时在数据链路层,要重新添加上MAC帧的首部和尾部。这时首部中的源地址和目的地址分别便成为HA4和HA5。路由器R2收到此帧后,再次更换MAC帧的首部和尾部,首部中的源地址和目的地址分别变成为HA6和HA2。MAC帧的首部的这种变化,在上面的IP层上是看不见的。</li>
<li>尽管互连在一起的网络的硬件地址体系各不相同,但IP层抽象的互联网却屏蔽了<br>下层这些很复杂的细节。只要我们在网络层上讨论问题,就能够使用统一的、抽象的IP地址研究主机和主机或路由器之间的通信。</li>
</ol>
<p>既然在网络链路上传送的帧最终是按照硬件地址找到目的主机的,那么为什么我们还要使用抽象的IP地址,而不直接使用硬件地址进行通信?</p>
<p>由于全世界存在着各式各样的网络,它们使用不同的硬件地址。要使这些异构网络能<br>够互相通信就必须进行非常复杂的硬件地址转换工作,因此由用户或用户主机来完成这项作几乎是不可能的事。但IP编址把这个复杂问题解决了。连接到互联网的主机只需各自拥有一个唯一的IP地址,它们之间的通信就像连接在同一个网络上那样简单方便,因为上述的调用ARP的复杂过程都是由计算机软件自动进行的,对用户来说是看不见这种调用过程的。</p>
<h4 id="地址解析协议ARP"><a href="#地址解析协议ARP" class="headerlink" title="地址解析协议ARP"></a>地址解析协议ARP</h4><p>网络层使用的是IP地址,但在实际网络的链路上传送数据帧时还是必须使用该网络的硬件地址。但IP地址和下面的网络的硬件地址之间由于格式不同而不存在简单的映射关系。此外,IP或MAC地址可能会改变。地址解析协议ARP解决这个问题的方法是在主机ARP高速缓存中存放一个从IP地址到硬件地址的映射表,并且这个映射表还经常动态更新(新增或超时删除)。<br>每一台主机都设有一个ARP高速缓存( ARP cache),里面有本局域网上的各主机和路由器的IP地址到硬件地址的映射表,这些都是该主机目前知道的一些地址。</p>
<h5 id="同一局域网"><a href="#同一局域网" class="headerlink" title="同一局域网"></a>同一局域网</h5><p>当主机A要向本局域网上的某台主机B发送IP数据报时,就先在其ARP高速缓存中<br>查看有无主机B的IP地址。</p>
<p>若有,就在ARP高速缓存中查出其对应的硬件地址,再把这硬件地址写入MAC帧,然后通过局域网把该MAC帧发往此硬件地址；<br>若没有,主机A就自动运行ARP,然后按以下步骤找出主机B的硬件地址。</p>
<ol>
<li>ARP进程在本局域网上广播发送一个ARP请求分组；</li>
<li>在本局域网上的所有主机上运行的ARP进程都收到此ARP请求分组</li>
<li>主机B的IP地址与ARP请求分组中要查询的P地址一致,就收下这个ARP请求分组,并向主机A发送ARP响应分组,同时在这个ARP响应分组中写入自己的硬件地址。由于其余的所有主机的IP地址都与ARP请求分组中要查询的IP地址不一致,因此都不理睬这个ARP请求分组。<br>ARP请求分组是广播发送的,但ARP响应分组是普通的单播。</li>
<li>主机A收到主机B的ARP响应分组后,就在其ARP高速缓存中写入主机B的IP地址到硬件地址的映射。同时主机B记录主机A的映射。</li>
</ol>
<p>ARP对保存在高速缓存中的每一个映射地址项目都设置生存时间凡超过生存时间的项目就从高速缓存中删除掉。</p>
<h5 id="不在同一局域网"><a href="#不在同一局域网" class="headerlink" title="不在同一局域网"></a>不在同一局域网</h5><p>四种情况：</p>
<p><img src="/images/network-basic/ARPfour.PNG"></p>
<ol>
<li>发送方是主机(如H1),要把IP数据报发送到同一个网络上的另一台主机(如<br>H2)。这时H发送ARP请求分组(在网1上广播),找到目的主机H2的硬件地址。</li>
<li>发送方是主机(如H1),要把IP数据报发送到另一个网络上的一台主机(如H3或<br>H4)。这时H1发送ARP请求分组(在网1上广播),找到网1上的一个路由器R1的硬件地<br>址。剩下的工作由路由器R1来完成。R1要做的事情是下面的(3)或(4)。</li>
<li>发送方是路由器(如R1),要把P数据报转发到与R1连接在同一个网络(网2)上<br>的主机(如H3)。这时R1发送ARP请求分组(在网2上广播),找到目的主机H3的硬件地<br>址</li>
<li>发送方是路由器(如R1),要把IP数据报转发到网3上的一台主机(如H4)。H4与<br>不是连接在同一个网络上。这时R1发送ARP请求分组(在网2上广播),找到连接在网<br>2上的一个路由器R2的硬件地址。剩下的工作由这个路由器R2来完成</li>
</ol>
<h4 id="IP数据报的格式"><a href="#IP数据报的格式" class="headerlink" title="IP数据报的格式"></a>IP数据报的格式</h4><p><img src="/images/network-basic/ip.PNG"></p>
<ul>
<li>版本：占4位,指P协议的版本。通信双方使用的P协议的版本必须一致。</li>
<li>首部长度：占4位,可表示的最大十进制数值是15。</li>
</ul>
<p>首部长度字段所表示数的单位是32位字(4字节)，因此首部长度字段的最小值是5，最大值15。当IP分组的首部长度不是4字节的整数倍时,必须利用最后的填充字段加以填充。因此IP数据报的数据部分永远在4字节的整数倍时开始,这样在实现IP协议时较为方便。</p>
<ul>
<li>区分服务：占8位,用来获得更好的服务。旧标准中叫做服务类型,但实际上一直没有被使用过。</li>
<li>总长度：总长度指首部和数据之和的长度,单位为字节。</li>
</ul>
<p>最常用的以太网规定其MTU值是1500字节。若所传送的数据报长度超过数据链路层的MTU值,就必须把过长的数据报进行分片处理。</p>
<p>虽然使用尽可能长的PP数据报会使传输效率得到提高,但每一个IP数据报越短,路由<br>转发的速度就越快。为此,IP协议规定,在互联网中所有的主机和路由器,必须能够接<br>受长度不超过576字节的数据报。这是假定上层交下来的数据长度有512字节,加上最长的IP首部60字节,再加上4字节的富余量,就得到576字节。当主机需要发送长度超过576字节的数据报时,应当先了解一下,目的主机能否接受所要发送的数据报长度。否则,就要进行分片。</p>
<p>在进行分片时(见后面的“片偏移”字段),数据报首部中的“总长度”字段是指分片<br>后的每一个分片的首部长度与该分片的数据长度的总和。</p>
<ul>
<li>标识：占16位。IP软件在存储器中维持一个计数器,每产生一个数据报,计数器就加1,并将此值赋给标识字段。</li>
</ul>
<p>但这个“标识”并不是序号,因为IP是无连接服务,数据报不存在按序接收的问题。当数据报由于长度超过网络的MTU而必须分片时,这个标识字段的值就被复制到所有的数据报片的标识字段中。相同的标识字段的值使分片后的各数据报片最后能正确地重装成为原来的数据报。</p>
<ul>
<li>标志：占3位,但目前只有两位有意义<ul>
<li>标志字段中的最低位记为MF(More Fragment)。MF=1即表示后面“还有分片”的数据报。MF=0表示这已是若干数据报片中的最后一个。</li>
<li>标志字段中间的一位记为DF(Don’ t Fragment),意思是“不能分片”。只有当DF<br>0时才允许分片。</li>
</ul>
</li>
<li>片偏移：占13位。片偏移指出:较长的分组在分片后,某片在原分组中的相对位置。也就是说,相对于用户数据字段的起点,该片从何处开始。片偏移以8个字节为偏移单位。这就是说,每个分片的长度一定是8字节(64位)的整数倍。</li>
</ul>
<p><img src="/images/network-basic/ip-shard.PNG"></p>
<ul>
<li>生存时间：占8位,生存时间字段常用的英文缩写是TTL( Time To live),表明<br>这是数据报在网络中的寿命。由发出数据报的源点设置这个字段。其目的是防止无法交付的数据报无限制地在互联网中兜圈子。</li>
</ul>
<p>然而随着技术的进步,路由器处理数据报所需的时间不断在缩短,一般都远远小于1秒,后来就把TTL字段的功能改为“跳数限制”(但名称不变)。路由器在每次转发数据报之前就把TTL值减1。若TTL值减小到零,就丢弃这个数据报,不再转发。因此,现在TTL的单位不再是秒,而是跳数。TTL的意义是指明数据报在互联网中至多可经过多少路由器。显然,数据报能在互联网中经过的路由器的最大数值是255。若把TTL的初始值设置为1,就表示这个数据报只能在本局域网中传送。因为这个数据报一传送到局域网上的某个路由器,在被转发之前TIL值就减小到零,因而就会被这个路由器丢弃。</p>
<ul>
<li>协议：占8位,协议字段指出此数据报携带的数据是使用何种协议,以便使目的<br>主机的IP层知道应将数据部分上交给哪个协议进行处理。</li>
<li>首部检验和占16位。这个字段只检验数据报的首部,但不包括数据部分。非CRC。</li>
<li>源地址：占32位。</li>
<li>目的地址：占32位。</li>
</ul>
<h4 id="IP层转发分组的流程"><a href="#IP层转发分组的流程" class="headerlink" title="IP层转发分组的流程"></a>IP层转发分组的流程</h4>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Study/">Study</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Network/">Network</a>
    </span>
    

    </div>

    
  </div>
</article>

  
	<section id="comment" class="comment">
		<div id="gitalk-container"></div>
	</section>
	<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
	<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
	<script>
		var gitalk = new Gitalk({
			clientID: '43df1f730957f2695673',
			clientSecret: '29fa4bdef022da54ce3ebc4ec844d1b5c418d42a',
			repo: 'memorykkk.github.io',
			owner: 'memorykkk',
			admin: ['memorykkk'],
			id: location.pathname,
			distractionFreeMode: false,
			createIssueManually: true,
			proxy: 'https://netnr-proxy.cloudno.de/https://github.com/login/oauth/access_token',
		})

		gitalk.render('gitalk-container')
	</script>







    </main>

    <footer class="site-footer">
  <p class="site-info" style="color='#9e9e9e'">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2020-2021 Memorykk
    
	<a href="http://beian.miit.gov.cn" target="_blank">陕ICP备20005895号-1</a>
  </p>
</footer>
    
    
  </div>
</div>

</body>
</html>